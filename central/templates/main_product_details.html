{% extends 'main_base.html' %}
{% load static %}
{% block content %}
<div class="container mx-auto mt-10 p-6 bg-white shadow-lg rounded-lg">
    <div class="flex flex-wrap md:flex-nowrap">
        <div class="w-full md:w-1/2 p-4">
            {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-auto object-cover rounded-lg shadow-md">
            {% else %}
            <img src="{{ MEDIA_URL }}product_images/default.webp" alt="default image" class="w-full h-auto object-cover rounded-lg shadow-md">
            {% endif %}
        </div>
        <div class="w-full md:w-1/2 p-4">
            <h2 class="text-3xl font-bold text-gray-800">{{ product.chemical_name }}</h2>
            <p class="mt-4 text-lg text-gray-600"><strong>Category:</strong> {{ product.get_category_display }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Description:</strong> {{ product.description }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Price:</strong> ${{ product.price }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Quantity Available:</strong> {{ product.quantity }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Expiry Date:</strong> {{ product.expiry_date }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Manufacturer:</strong> {{ product.manufacturer }}</p>
            <p class="mt-2 text-lg text-gray-600"><strong>Company Name:</strong> {{ product.company_name }}</p>
            <form id="add-to-cart-form" action="{% url 'central:add-to-cart' product.id %}" method="post" class="mt-6">
                {% csrf_token %}
                <button type="submit" class="px-6 py-2 text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-600 focus:ring-opacity-50">Add to Cart</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block javascript %}
<script>
document.getElementById('add-to-cart-form').addEventListener('submit', function(event) {
    event.preventDefault();
    const form = event.target;
    const url = form.action;
    const csrfToken = form.querySelector('[name=csrfmiddlewaretoken]').value;

    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrfToken,
        },
        body: JSON.stringify({ quantity: 1 }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            window.location.href = '{% url "central:view-cart" %}';
        } else {
            alert('Failed to add product to cart');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
    });
});
</script>
{% endblock %}
